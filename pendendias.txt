from flask_sqlalchemy import SQLAlchemy
from datetime import datetime

db = SQLAlchemy()

class Usuario(db.Model):
    __tablename__ = 'usuarios'
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)
    email = db.Column(db.String(100), unique=True, nullable=False)
    senha = db.Column(db.String(200), nullable=False)
    clinica_id = db.Column(db.Integer)
    tipo = db.Column(db.String(50)) # admin, veterinario, recepcionista

class Tutor(db.Model):
    __tablename__ = 'tutores'
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)
    cpf = db.Column(db.String(14))
    nascimento = db.Column(db.String(10))
    telefone = db.Column(db.String(20))
    telefone2 = db.Column(db.String(20))
    email = db.Column(db.String(100))
    endereco = db.Column(db.String(200))
    bairro = db.Column(db.String(100))
    cidade = db.Column(db.String(100))

class Animal(db.Model):
    __tablename__ = 'animais'
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)
    especie = db.Column(db.String(50))
    raca = db.Column(db.String(50))
    sexo = db.Column(db.String(10))
    peso = db.Column(db.Float)
    nascimento = db.Column(db.String(10))
    alergias = db.Column(db.Text)
    vacinacao = db.Column(db.Text)
    tutor_id = db.Column(db.Integer, db.ForeignKey('tutores.id'), nullable=False)
    
    tutor = db.relationship('Tutor', backref=db.backref('animais', lazy=True))

class Veterinario(db.Model):
    __tablename__ = 'veterinarios'
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)
    crmv = db.Column(db.String(20))
    telefone = db.Column(db.String(20))
    email = db.Column(db.String(100))
    especialidade = db.Column(db.String(100))

class Atendimento(db.Model):
    __tablename__ = 'atendimentos'
    id = db.Column(db.Integer, primary_key=True)
    data_hora = db.Column(db.DateTime, default=datetime.utcnow)
    status = db.Column(db.String(50), default='Aguardando') # Aguardando, Em Atendimento, Finalizado
    prioridade = db.Column(db.String(20)) # Normal, Urgência, Emergência
    motivo = db.Column(db.String(200))
    peso = db.Column(db.Float)
    temperatura = db.Column(db.Float)
    queixa = db.Column(db.Text)
    observacoes = db.Column(db.Text)
    
    animal_id = db.Column(db.Integer, db.ForeignKey('animais.id'), nullable=False)
    tutor_id = db.Column(db.Integer, db.ForeignKey('tutores.id'), nullable=False)
    veterinario_id = db.Column(db.Integer, db.ForeignKey('veterinarios.id'), nullable=True)
    
    animal = db.relationship('Animal', backref='atendimentos')
    tutor = db.relationship('Tutor', backref='atendimentos')
    veterinario = db.relationship('Veterinario', backref='atendimentos')

class Agendamento(db.Model):
    __tablename__ = 'agenda'
    id = db.Column(db.Integer, primary_key=True)
    data = db.Column(db.String(10))
    horario = db.Column(db.String(5))
    servico = db.Column(db.String(100))
    observacoes = db.Column(db.Text)
    status = db.Column(db.String(20), default='Agendado')
    
    animal_id = db.Column(db.Integer, db.ForeignKey('animais.id'))
    veterinario_id = db.Column(db.Integer, db.ForeignKey('veterinarios.id'))
    
    animal = db.relationship('Animal', backref='agendamentos')
    veterinario = db.relationship('Veterinario', backref='agendamentos')
